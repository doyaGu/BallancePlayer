# BallancePlayer

## 概述

BallancePlayer 是为游戏《Ballance》设计的现代化增强版主程序，通过反编译和改进原始版本开发而成。它在保持与原版游戏兼容的同时，提供了多项新功能和优化，带来更好的游戏体验。

## 特点

- 开箱即用，无需配置即可启动游戏
- 支持 `.ini` 文件配置
- 支持灵活的命令行选项
- 支持 32 位色彩模式
- 兼容不支持 640x480 分辨率的显示器
- 支持高刷新率显示器
- 支持游戏内分辨率切换
- 提供切换全屏模式和关闭游戏的快捷键
- 无需修改注册表
- 不依赖于 `Dsetup.dll`
- 集成 `ResDll.dll`，便捷运行
- 修复了原版播放器中的一些问题
- 提升了性能

## 系统要求

支持以下 Windows 版本：
- Windows XP
- Windows Vista
- Windows 7
- Windows 8 / 8.1
- Windows 10
- Windows 11

## 安装说明

1. 将提供的压缩包解压至游戏文件夹中的 `Bin` 目录。
2. 运行 `Player.exe` 启动游戏，无需设置兼容模式。

## 从源码构建

### 依赖项

构建 BallancePlayer 需要 Virtools SDK，可以从 [Virtools-SDK-2.1](https://github.com/doyaGu/Virtools-SDK-2.1) 获取。在开始构建之前，请将环境变量 `VIRTOOLS_SDK_PATH` 设置为 SDK 的安装路径。

### 使用 CMake 构建

1. **安装 CMake**：确保你的系统上已安装 CMake。
2. **进入项目目录**：打开控制台，进入包含 BallancePlayer 源代码的目录。
3. **生成构建文件**：运行以下命令生成 Visual Studio 项目文件：
   ```
   cmake -B build -G "Visual Studio 16 2022" -A Win32
   ```
4. **在 Visual Studio 中打开**：进入 `build` 目录，打开 `BallancePlayer.sln` 解决方案文件。
5. **构建解决方案**：使用 Visual Studio 的构建工具编译项目。

### 使用 Visual Studio 6.0 构建

1. **安装 Visual Studio 6.0**：确保已安装 Visual Studio 6.0。
2. **打开项目**：在项目目录中找到 `Player.dsw` 并使用 Visual Studio 6.0 打开。
3. **构建项目**：使用 Visual Studio 6.0 的构建工具编译项目。

### 注意事项

官方发行版本为最大限度地提高兼容性，使用 Visual Studio 6.0 进行构建。

## 快捷键

- **[Alt] + [Enter]**：切换窗口模式和全屏模式。
- **[Alt] + [F4]**：强制关闭游戏。
- **[Alt] + [/]**：显示关于窗口。

## INI 设置

`Player.ini` 文件包含多个用于控制游戏行为的设置。

### 启动

- `LogMode`：控制日志处理方式。
  - `0`：追加到日志文件。
  - `1`：覆盖日志文件。
- `Verbose`：控制是否启用详细日志。
  - `0`：禁用。
  - `1`：启用。
- `ManualSetup`：控制是否在启动时显示设置对话框。
  - `0`：禁用。
  - `1`：启用。

### 图形设置

- `Driver`：指定要使用的显卡驱动 ID。
- `BitsPerPixel`：指定色彩深度。
  - `32`：32 位色。
  - `16`：16 位色。
- `Width`：指定屏幕宽度（根据显示器分辨率）。
- `Height`：指定屏幕高度（根据显示器分辨率）。
- `FullScreen`：控制显示模式。
  - `0`：窗口模式。
  - `1`：全屏模式。
- `DisablePerspectiveCorrection`：控制是否禁用透视修正。
  - `0`：关闭。
  - `1`：开启。
- `ForceLinearFog`：强制使用线性雾模式。
  - `0`：关闭。
  - `1`：开启。
- `ForceSoftware`：禁用硬件渲染。
  - `0`：关闭。
  - `1`：开启。
- `DisableFilter`：禁用纹理过滤。
  - `0`：关闭。
  - `1`：开启。
- `EnsureVertexShader`：确保启用顶点着色器支持。
  - `0`：关闭。
  - `1`：开启。
- `UseIndexBuffers`：启用索引缓冲区。
  - `0`：关闭。
  - `1`：开启。
- `DisableDithering`：禁用抖动。
  - `0`：关闭。
  - `1`：开启。
- `Antialias`：设置抗锯齿级别（最小值为 2）。
- `DisableMipmap`：禁用 Mipmap。
  - `0`：关闭。
  - `1`：开启。
- `DisableSpecular`：禁用高光。
  - `0`：关闭。
  - `1`：开启。
- `EnableScreenDump`：启用屏幕转储功能。
  - `0`：关闭。
  - `1`：开启。
- `EnableDebugMode`：启用逐步渲染的调试模式。
  - `0`：关闭。
  - `1`：开启。
- `VertexCache`：设置顶点缓存大小。`0` 值表示禁用排序。
- `TextureCacheManagement`：控制是否启用纹理缓存管理。
  - `0`：关闭。
  - `1`：开启。
- `SortTransparentObjects`：控制是否对透明对象进行排序。
  - `0`：关闭。
  - `1`：开启。
- `TextureVideoFormat`：指定纹理的默认像素格式（例如 `_32_ARGB8888`）。
- `SpriteVideoFormat`：指定精灵的默认像素格式（例如 `_32_ARGB8888`）。

### 窗口设置

- `ChildWindowRendering`：控制是否在子窗口中渲染。
  - `0`：禁用。
  - `1`：启用。
- `Borderless`：控制窗口是否无边框。
  - `0`：禁用。
  - `1`：启用。
- `ClipCursor`：控制是否限制鼠标光标在窗口内。
  - `0`：禁用。
  - `1`：启用。
- `AlwaysHandleInput`：允许窗口在后台时仍然处理输入。
  - `0`：禁用。
  - `1`：启用。
- `X`：设置窗口的水平坐标（可以为负值）。
- `Y`：设置窗口的垂直坐标（可以为负值）。

### 游戏设置

- `Language`：设置游戏语言。
  - `0`：德语。
  - `1`：英语。
  - `2`：西班牙语。
  - `3`：意大利语。
  - `4`：法语。
- `SkipOpening`：控制是否跳过开场动画。
  - `0`：禁用。
  - `1`：启用。
- `ApplyHotfix`：控制是否应用热修复。
  - `0`：禁用。
  - `1`：启用。
- `UnlockFramerate`：解锁帧率限制。
  - `0`：禁用。
  - `1`：启用。
- `UnlockWidescreen`：解锁非 4:3 分辨率。
  - `0`：禁用。
  - `1`：启用。
- `UnlockHighResolution`：解锁高于 1600x1200 的分辨率。
  - `0`：禁用。
  - `1`：启用。
- `Debug`：启用游戏内调试模式。
  - `0`：禁用。
  - `1`：启用。
- `Rookie`：启用游戏内新手模式。
  - `0`：禁用。
  - `1`：启用。

## 命令行选项

你还可以使用命令行选项来自定义游戏行为：

```bash
Player.exe [OPTIONS]
```
- `--verbose`：启用详细日志记录。
- `-m`, `--manual-setup`：启动时总是显示设置对话框。
- `-v <driver>`, `--video-driver <driver>`：设置显卡驱动 ID。
- `-b <bpp>`, `--bpp <bpp>`：设置屏幕的色彩深度（32 或 16）。
- `-w <width>`, `--width <width>`：设置屏幕宽度。
- `-h <height>`, `--height <height>`：设置屏幕高度。
- `-f`, `--fullscreen`：启动时进入全屏模式。
- `--disable-perspective-correction`：禁用透视修正。
- `--force-linear-fog`：强制使用线性雾。
- `--force-software`：禁用硬件渲染并强制使用软件模式。
- `--disable-filter`：禁用纹理过滤。
- `--ensure-vertex-shader`：确保顶点着色器支持。
- `--use-index-buffers`：启用索引缓冲区。
- `--disable-dithering`：禁用抖动。
- `--antialias <level>`：启用抗锯齿（最小值：2）。
- `--disable-mipmap`：禁用 Mipmap。
- `--disable-specular`：禁用高光。
- `--enable-screen-dump`：使用 (CTRL + ALT + F10) 保存屏幕内容。
- `--enable-debug-mode`：使用 (CTRL + ALT + F11) 启用调试模式。
- `--vertex-cache <size>`：设置顶点缓存大小（0 禁用排序）。
- `--disable-texture-cache-management`：禁用纹理缓存管理。
- `--disable-sort-transparent-objects`：禁用透明对象排序。
- `--texture-video-format <pixel-format>`：设置纹理的像素格式（如 `_32_ARGB8888`）。
- `--sprite-video-format <pixel-format>`：设置精灵的像素格式（如 `_32_ARGB8888`）。
- `-s`, `--child-window-rendering`：启用子窗口渲染。
- `-c`, `--borderless`：启动时进入无边框模式。
- `--clip-cursor`：限制鼠标光标在窗口内。
- `--always-handle-input`：允许窗口在后台时处理输入。
- `-x <X>`, `--position-x <X>`：设置窗口的 X 坐标。
- `-y <Y>`, `--position-y <Y>`：设置窗口的 Y 坐标。
- `-l <lang>`, `--lang <lang>`：设置游戏语言。
- `--skip-opening`：跳过开场动画。
- `--disable-hotfix`：禁用脚本热修复。
- `-u`, `--unlock-framerate`：解除帧率限制。
- `--unlock-widescreen`：解锁非 4:3 分辨率。
- `--unlock-high-resolution`：解锁高于 1600x1200 的分辨率。
- `d`, `--debug`：启用游戏内调试模式。
- `r`, `--rookie`：启用游戏内新手模式。

## 联系方式

如果你有任何问题或功能请求，请在 GitHub 上进行反馈：[BallancePlayer](https://github.com/doyaGu/BallancePlayer)。

## 更新日志

### v0.3.6 (2025-08-20)

**变更**

- 由 ANSI 编码切换为 Unicode，以提升兼容性与国际化支持。

### v0.3.5 (2025-05-23)

**新功能**

- 引入了一个独立的配置工具，便于更轻松地管理游戏设置。
- 增加了对加载自定义游戏文件的支持。

**问题修复**

- 修复了启用详细日志记录时可能导致的崩溃问题。

**变更**

- 移除了已弃用的设置项：`LoadAllManagers`、`LoadAllBuildingBlocks` 和 `LoadAllPlugins`。
- 游戏在窗口失去焦点时默认不再暂停。

### v0.3.4 (2025-04-24)

**新功能**

- 添加了 DPI 感知处理支持，改善在不同显示器配置下的显示缩放效果。

**问题修复**

- 修复了命令行解析器可能导致参数处理错误的问题。
- 解决了频繁切换窗口模式和全屏模式时导致的游戏加速异常问题。

**变更**

- 移除了已弃用的 `PauseOnDeactivated` 设置。
- 增强了错误处理机制，提供更详细的错误信息并改进了从常见故障状态中的恢复能力。

### v0.3.3 (2024-10-01)

**新功能**

- 添加了 `LogMode` 设置用于控制日志模式。
- 添加了 `Verbose` 设置和 `--verbose` 选项用于控制调试日志输出。
- 引入了 `ApplyHotfix` 设置和 `--no-hotfix` 选项用于控制是否应用脚本热修复。
- 添加了 `ClipCursor` 设置和 `--clip-cursor` 选项用于管理鼠标光标限制行为。
- 增加了更多图形设置和选项。
- 改进了错误消息提示，使其更加清晰。

**变更**

- 日志现在会覆盖现有文件而不是追加到其中。
- 重新组织了配置类别以获得更好的结构。
- 尽可能使用相对路径。

### v0.3.2 (2024-07-16)

**问题修复**

- 修复了插件注册中断的问题。

**变更**

- 应用程序窗口现在默认在屏幕中央打开。

### v0.3.1 (2024-03-04)

**问题修复**

- 修复了异常分辨率设置可能导致的潜在问题。

### v0.3.0 (2023-05-20)

**新功能**

- 添加了 `ChildWindowRendering` 设置和 `--child-window-rendering` 选项，用于控制是否在子窗口中进行渲染。

**问题修复**

- 解决了切换到全屏模式时可能出现的黑屏问题。

**变更**

- 默认情况下，不再在单独的窗口中进行渲染。

### v0.2.4 (2023-03-23)

**问题修复**

- 修复了在设置对话框中未选择屏幕模式时游戏初始化失败的问题。
- 修正了渲染驱动程序初始化过程。

### v0.2.3 (2023-03-13)

**新功能**

- 添加了运行游戏多个实例的支持。

**问题修复**

- 修复了退出游戏时发生的崩溃问题。

**变更**

- 弃用了 `Resizable` 和 `ClipMouse` 设置。
- 增强了错误消息以提高清晰度。
- 重构了代码库以简化实现。

### v0.2.2 (2023-01-23)

**新功能**

- 添加了 `ManualSetup` 设置和相应的 `--manual-setup` 命令行选项，用于控制是否在启动时显示设置对话框。

**问题修复**

- 修复了命令行短选项解析中的问题。

**变更**

- 弃用了 `AdaptiveCamera` 设置。
- 弃用了延迟加载的 DLL。
- 弃用了路径自定义。
- 简化了驱动程序和屏幕模式枚举的变通方法。

### v0.2.1 (2022-11-24)

**新功能**

- 添加了控制台日志支持。
- 添加了 `LoadAllManagers` 设置和 `--load-all-managers` 命令行选项，用于控制是否加载所有管理器。
- 添加了 `LoadAllBuildingBlocks` 设置和 `--load-all-building-blocks` 选项，用于控制是否加载所有构建模块。
- 添加了 `LoadAllPlugins` 设置和 `--load-all-plugins` 命令行选项，用于控制是否加载所有插件。

**问题修复**

- 修复了屏幕模式可能被错误更改的问题。
- 解决了由于路径设置不正确导致的启动失败。

**变更**

- 移除了对修改版 `TT_InterfaceManager_RT.dll` 的依赖。

### v0.2.0 (2022-10-15)

**新功能**

- 添加了中文版 README。

### v0.2.0-rc1 (2022-10-09)

**问题修复**

- 修复了退出游戏时可能发生的潜在崩溃问题。

**变更**

- 改进了游戏循环以获得更好的性能。

### v0.2.0-beta4 (2022-10-02)

**问题修复**

- 修复了在使用 OpenGL 时无法在全屏和窗口模式之间切换的问题。
- 解决了可能导致错误的任务切换问题。

### v0.2.0-beta3 (2022-10-01)

**问题修复**

- 修复了全屏模式下任务切换时出现的 UI 崩溃。
- 解决了指定显示驱动程序无效的问题。

**变更**

- 在 `全屏设置` 对话框中交换了 `驱动程序` 和 `屏幕模式` 的位置。

### v0.2.0-beta2 (2022-09-28)

**问题修复**

- 修复了退出后弹出黑屏的问题。

### v0.2.0-beta1 (2022-09-28)

**问题修复**

- 修复了强制全屏垂直同步。
- 修复了窗口位置无法正确恢复的问题。

### v0.2.0-alpha4 (2022-09-25)

**问题修复**

- 解决了在不支持 640x480 分辨率的显示器上出现黑屏错误的问题。

### v0.2.0-alpha2 (2022-09-23)

**新功能**

- 添加了游戏内调试模式支持。
- 引入了新的命令行选项，如 `--root-path=<dir>`。

### v0.2.0-alpha1 (2022-09-17)

**新功能**

- 添加了对更多分辨率、跳过开场动画、鼠标限制、非本地启动、游戏路径自定义和 Virtools 控制台输出的支持。
- 引入了许多新设置和相应的命令行选项。

**问题修复**

- 修复了全屏设置的问题。
- 解决了使用自定义分辨率时播放器会卡住的问题。

**变更**

- 统一了日志和错误输出。
- 重新安排了设置和相应的命令行选项。

### v0.1.9 (2022-08-30)

**问题修复**

- 修复了退出全屏模式时的位置保存机制问题。

**变更**

- 如果窗口可调整大小（带有标题），当窗口位置设置为 0 时，现在会出现在左上角，与屏幕边缘保持较小的边距。
- 保存的窗口位置值现在可以为负值。
- 游戏现在会保存最后使用的游戏模式（全屏或窗口），并在下次启动时恢复。

### v0.1.8 (2022-08-17)

**问题修复**

- 修复了在启用垂直同步的情况下，游戏在 144Hz 显示器上被锁定在 60 FPS 的问题。
- 解决了阻止游戏找到多个显示驱动程序的错误。

### v0.1.7 (2022-08-15)

**新功能**

- 添加了 `X` 和 `Y` 设置以及相应的 `-x` 和 `-y` 选项，用于设置窗口左上角的屏幕坐标。

**问题修复**

- 修复了游戏窗口在启动前不自然调整大小的问题。

**变更**

- 现在会保存最后的窗口位置并在下次启动时恢复。

### v0.1.6 (2022-08-05)

**新功能**

- 添加了 `Borderless` 设置和 `-c` 选项，用于以无边框模式启动。
- 添加了 `Resizable` 设置和 `-s` 选项，使窗口可以调整大小。

**变更**

- 窗口现在默认不可调整大小。

### v0.1.5 (2022-07-20)

**新功能**

- 添加了对 32 位色彩模式的支持。
- 添加了对命令行长选项的支持。
- 添加了 `Language` 设置和 `-l` 选项用于设置游戏语言。
- 添加了 `UnlockFramerate` 设置和 `-u` 选项用于解锁帧率限制。

**问题修复**

- 修复了任务切换期间的 UI 混乱错误。

**变更**

- 将禁用任务切换的命令行选项从 `-d` 更改为 `-e`。
- 重新实现了初始化配置机制。
- 重写了命令行支持。
- 集成了 `ResDll` 的功能。

### v0.1.4 (2022-05-12)

**新功能**

- 添加了 `PauseOnTaskSwitch` 设置和 `-p` 选项，用于在任务切换期间启用游戏暂停。

**问题修复**

- 修复了游戏过早退出和退出时崩溃的错误。

**变更**

- 移除了不必要的虚拟函数以提高性能。
- 移除了未使用的界面精灵。
- 改进了错误处理。

### v0.1.3 (2022-05-09)

**新功能**

- 添加了对命令行选项的支持。

**问题修复**

- 修复了全屏崩溃。
- 修复了任务切换问题。
- 修复了图形选项中的重复分辨率。

**变更**

- 移除了对 `Dsetup.dll` 的依赖，因为在现代电脑上检查 DirectX 是不必要的。
- 移除了异常处理以提高性能。

### v0.1.2 (2022-05-08)

**问题修复**

- 修复了游戏在退出时可能崩溃的问题。

**变更**

- 在未找到配置文件时，现在会生成默认配置文件。
- 替换了主函数中剩余的注册表操作。
- 移除了 `FixedString`。

### v0.1.1 (2022-05-04)

**新功能**

- 添加了对初始化文件配置的支持。

**问题修复**

- 修复了游戏在窗口模式下显示不完整的问题。

**变更**

- 移除了一些未知的类成员。

### v0.1.0 (2022-05-03)

**问题修复**

- 修复了导致不正确结果的内存检查错误。